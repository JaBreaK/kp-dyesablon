---
import '../styles/global.css';
import '../styles/transitions.css';
import { ViewTransitions } from 'astro:transitions';

export interface Props {
  title: string;
  description?: string;
}

const { 
  title, 
  description = "Nyablonn Disini brok!!"
} = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (!localStorage.getItem("staffSession")) return window.location.replace("/login");
    });
  </script>
  <style>
    button[data-loading] {
      position: relative;
    }
    button[data-loading].loading {
      cursor: not-allowed;
      opacity: 0.6;
    }
    button[data-loading].loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 1rem;
      height: 1rem;
      margin-top: -0.5rem;
      margin-left: -0.5rem;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 1;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }


  </style>
<style>
  .sidebar-link {
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    color: #374151; /* text-gray-700 */
    text-decoration: none;
    transition: background-color 0.2s ease-in-out;
  }

  .sidebar-link:hover {
    background-color: #f3f4f6; /* hover:bg-gray-100 */
  }

  .sidebar-link.active {
    background-color: #e5e7eb; /* bg-gray-200 */
    color: #4f46e5; /* text-indigo-700 */
    font-weight: 600;
  }

  .sidebar-icon {
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.75rem;
    flex-shrink: 0;
  }
</style>


  
</head>
<body>
<div class="flex h-screen bg-gray-100">
  <aside class="w-64 bg-white border-r hidden md:flex flex-col">
    <div class="p-4">
      <a href="/admin"  class="text-2xl font-semibold block mb-6 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        Admin Panel
      </a>
      <nav class="space-y-2">
        <a href="/admin/" data-path="/admin/" class="sidebar-link flex items-center px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          Dashboard
        </a>
        <a href="/admin/katalog" data-path="/admin/katalog" class="sidebar-link flex items-center px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
          Katalog
        </a>
        <a href="/admin/banner" data-path="/admin/banner" class="sidebar-link flex items-center px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          Banner
        </a>
        <a href="/admin/koleksi" data-path="/admin/koleksi" class="sidebar-link flex items-center px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
          </svg>
          Koleksi
        </a>
        <a href="/admin/bahan" data-path="/admin/bahan" class="sidebar-link flex items-center px-3 py-2 rounded hover:bg-gray-100 text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          Bahan
        </a>
      </nav>
    </div>
  </aside>

  <div class="flex-1 flex flex-col overflow-hidden">
    <header class="flex items-center justify-between bg-white px-4 py-2 shadow-sm">
      <h1 class="text-xl font-semibold text-gray-800">{title}</h1>
      <div class="relative">
        <button id="profile-button" class="flex items-center space-x-2 focus:outline-none">
          <img src="https://raw.githubusercontent.com/JaBreaK/db/refs/heads/main/kiles-removebg-preview.png" alt="Avatar" class="w-8 h-8 rounded-full" />
          <span id="admin-name" class="text-sm font-medium text-gray-700">Admin</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div id="profile-menu" class="hidden absolute right-0 mt-2 w-40 bg-white border rounded shadow-md z-10">
          <button id="btn-logout" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-700">Logout</button>
          <button id="recovery" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-700">Ganti Password</button>

        </div>
      </div>
    </header>

    <main class="p-4 overflow-auto">
      <slot />
    </main>
  </div>
</div>

<script type="module" >
  // Logout handler
  document.getElementById("btn-logout").addEventListener("click", () => {
    localStorage.removeItem("staffSession");
    window.location.replace("/login");
  });
    document.getElementById("recovery").addEventListener("click", () => {
    window.location.replace("/recovery");
  });

  // Dropdown handler
  const profileButton = document.getElementById('profile-button');
  const profileMenu = document.getElementById('profile-menu');
  if (profileButton) {
    profileButton.addEventListener('click', () => {
      profileMenu.classList.toggle('hidden');
    });
    document.addEventListener('click', (e) => {
      if (!profileButton.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.add('hidden');
      }
    });
  }

  // Ambil nama dari email
  try {
    const session = JSON.parse(localStorage.getItem("staffSession"));
    const email = session?.email ?? "";
    if (email.includes("@")) {
      const name = email.split("@")[0].toUpperCase();
      document.getElementById("admin-name").textContent = name;
    }
  } catch (e) {
    console.warn("Gagal parsing staffSession:", e);
  }
</script>
<script >
  document.addEventListener("DOMContentLoaded", () => {
    const currentPath = window.location.pathname;
    const links = document.querySelectorAll(".sidebar-link");

    links.forEach(link => {
      const path = link.getAttribute("data-path");
      if (currentPath === path || currentPath.startsWith(path + "/")) {
        link.classList.add("active");
      }
    });
  });
</script>


</body>
</html>
