<!-- Minimal animated dark-only carousel dengan plain JavaScript, Tailwind CSS, dan kompatibel Turbo -->
<section id="hero-carousel" class="relative overflow-hidden h-screen hero-section">
  <!-- Slides Container -->
  <div id="slides" class="absolute inset-0">
    <!-- Slides akan di-inject di sini -->
  </div>

  <!-- Dark Overlay for Contrast -->
  <div class="absolute inset-0 bg-black/30 dark:bg-black/50"></div>

  <!-- Content -->
  <div class="relative z-10 container-custom flex items-center justify-center h-full">
    <!-- Hero Content -->
    <div class="text-white text-center px-4">
      <h1 class="text-4xl sm:text-6xl font-bold">
        <span class="font-brand1 text-[#D4AF37]">DYE</span>
        <span class="font-display">APPAREL</span>
      </h1>
      <p class="mt-4 text-xl">Custom Tanpa Batas</p>
      <a href="https://wa.me/c/6289601651641" target="_blank" class="mt-6 inline-block btn-outline">
        Custom Sekarang
      </a>
    </div>
  </div>
</section>

<script type="module">
  // Simpan referensi interval dan status slide di luar fungsi, supaya bisa di-clear sebelum inisiasi ulang
  let carouselIntervalId = null;
  let carouselCurrentIndex = 0;

  function initHeroCarousel() {
    // Jika sebelumnya sudah ada interval berjalan, bersihkan dulu
    if (carouselIntervalId) {
      clearInterval(carouselIntervalId);
      carouselIntervalId = null;
    }
    const slideCount = 3; // jumlah slide, ubah sesuai kebutuhan
    const slidesContainer = document.getElementById('slides');
    if (!slidesContainer) {
      console.warn('Hero carousel: elemen #slides tidak ditemukan');
      return;
    }

    // Sebelum inisiasi ulang, kosongkan kontainer slide agar tidak duplikat slide lama
    slidesContainer.innerHTML = '';

    // Reset index
    carouselCurrentIndex = 0;

    // Generate hanya dark-mode slides
    for (let i = 1; i <= slideCount; i++) {
      const div = document.createElement('div');
      div.className = 'absolute inset-0 bg-center bg-cover filter blur-[3px] opacity-0 transition-opacity duration-1000';
      div.dataset.index = i - 1;
      div.style.backgroundImage = `url(https://pmfzypvynmyotmvbgafi.supabase.co/storage/v1/object/public/images/HOME/LP-DARK-${i}.jpg)`;
      slidesContainer.appendChild(div);
    }

    function showSlide(index) {
      const slides = slidesContainer.children;
      if (!slides || slides.length === 0) return;
      for (const slide of slides) {
        slide.classList.remove('opacity-100');
        slide.classList.add('opacity-0');
      }
      // Pastikan index valid
      const idx = index % slides.length;
      slides[idx].classList.remove('opacity-0');
      slides[idx].classList.add('opacity-100');
      carouselCurrentIndex = idx;
    }

    function nextSlide() {
      showSlide((carouselCurrentIndex + 1) % slideCount);
    }

    // Initialize tampilan pertama
    showSlide(0);
    // Set interval
    carouselIntervalId = setInterval(nextSlide, 5000);
  }

  // Bersihkan sebelum Turbo cache halaman
  function cleanupHeroCarousel() {
    // Hentikan interval
    if (carouselIntervalId) {
      clearInterval(carouselIntervalId);
      carouselIntervalId = null;
    }
    // Kosongkan slides agar Turbo tidak menyimpan elemen lama
    const slidesContainer = document.getElementById('slides');
    if (slidesContainer) {
      slidesContainer.innerHTML = '';
    }
  }

document.addEventListener('astro:page-load', () => {
    initHeroCarousel();
  });
</script>
